<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Adding a new Menu Item &mdash; PsychoPy v3.0</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.0.0b2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="PsychoPy v3.0" href="../index.html" />
    <link rel="up" title="For Developers" href="developers.html" />
    <link rel="next" title="PsychoPy Experiment file format (.psyexp)" href="../psyexp.html" />
    <link rel="prev" title="Localization (I18N, translation)" href="localization.html" /> 
  </head>
  <body>


<div id="header"  style="background-color: white">
<table width="100%" cellpadding="10">
<tr><td style="text-align:left;vertical-align:middle">
<a href='http://www.psychopy.org'><img src="../_static/psychopyDocBanner2.gif" alt="PsychoPy logo" /></a>
</td><td style="text-align:right;vertical-align:middle">
<a href='http://www.nottingham.ac.uk'><img src=../_static/UoN_Supported_RGBsm.png alt="University of Nottingham" /></a>
</td></table>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../psyexp.html" title="PsychoPy Experiment file format (.psyexp)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="localization.html" title="Localization (I18N, translation)"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">PsychoPy</a> &raquo;</li>
          <li><a href="../documentation.html" >Documentation</a> &raquo;</li>
          <li><a href="developers.html" accesskey="U">For Developers</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Adding a new Menu Item</a><ul>
<li><a class="reference internal" href="#makemenus">1. makeMenus()</a></li>
<li><a class="reference internal" href="#wxids-py">2. wxIDs.py</a></li>
<li><a class="reference internal" href="#key-binding-prefs">3. Key-binding prefs</a></li>
<li><a class="reference internal" href="#your-new-method">4. Your new method</a></li>
<li><a class="reference internal" href="#documentation">5. Documentation</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="localization.html"
                                  title="previous chapter">Localization (I18N, translation)</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="../psyexp.html"
                                  title="next chapter">PsychoPy Experiment file format (.psyexp)</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/developers/menuitem.rst.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>

            <h3>Quick links</h3>
            <ul>
            <li><a href="http://psychopy.org/installation.html"><strong>Download</strong></a></li>
            <li><a href="http://discourse.psychopy.org">Forum</a></li>
            <li><a href="http://twitter.com/psychopy">Twitter</a></li>
            </ul>

            <!-- facebook like -->
            <div id="fb-root"></div><script src="http://connect.facebook.net/en_US/all.js#appId=122767831154831&amp;xfbml=1"></script>
            <fb:like href="http://www.facebook.com/pages/PsychoPy/140222406067597" send="false" layout="button_count" width="300" show_faces="false" action="like" font=""></fb:like>

            <!-- google +1 -->
            <!-- Place this tag where you want the +1 button to render -->
            <g:plusone count="false" href="http://www.psychopy.org"></g:plusone>
            <!-- Place this tag after the last plusone tag -->
            <script type="text/javascript">
              window.___gcfg = {lang: 'en-GB'};
              (function() {
                var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                po.src = 'https://apis.google.com/js/plusone.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
              })();
            </script>

          <div id="searchbox" style="display: none">
            <h3>Searches</h3>
            <form action="http://www.google.com/cse" id="cse-search-box">
                <input type="hidden" name="cx" value="partner-pub-0861691574026297:eyw5n7-ugep" />
                <input type="hidden" name="ie" value="ISO-8859-1" />
                <input type="text" name="q" size="20" />
                <input type="submit" name="sa" value="Go" />
            </form>
              <p class="searchtip" style="font-size: 90%">
              General
              </p>
            <script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Docs only
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="adding-a-new-menu-item">
<span id="addmenuitem"></span><h1>Adding a new Menu Item<a class="headerlink" href="#adding-a-new-menu-item" title="Permalink to this headline">¶</a></h1>
<p>Adding a new menu-item to the Builder (or Coder) is relatively straightforward, but there are several files that need to be changed in specific ways.</p>
<div class="section" id="makemenus">
<h2>1. makeMenus()<a class="headerlink" href="#makemenus" title="Permalink to this headline">¶</a></h2>
<p>The code that constructs the menus for the Builder is within a method named <cite>makeMenus()</cite>, within class builder.BuilderFrame(). Decide which submenu your new command fits under, and look for that section (e.g., File, Edit, View, and so on). For example, to add an item for making the Routine panel items larger, I added two lines within the View menu, by editing the <cite>makeMenus()</cite> method of class <cite>BuilderFrame</cite> within <cite>psychopy/app/builder/builder.py</cite> (similar for Coder):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">viewMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IDs</span><span class="o">.</span><span class="n">tbIncrRoutineSize</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;&amp;Routine Larger</span><span class="se">\t</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="s1">&#39;largerRoutine&#39;</span><span class="p">],</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Larger routine items&quot;</span><span class="p">))</span>
<span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">IDs</span><span class="o">.</span><span class="n">tbIncrRoutineSize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">routinePanel</span><span class="o">.</span><span class="n">increaseSize</span><span class="p">)</span>
</pre></div>
</div>
<p>Note the use of the translation function, _(), for translating text that will be displayed to users (menu listing, hint).</p>
</div>
<div class="section" id="wxids-py">
<h2>2. wxIDs.py<a class="headerlink" href="#wxids-py" title="Permalink to this headline">¶</a></h2>
<p>A new item needs to have a (numeric) ID so that <cite>wx</cite> can keep track of it. Here, the number is <cite>self.IDs.tbIncrRoutineSize</cite>, which I had to define within the file <cite>psychopy/app/wxIDs.py</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tbIncrRoutineSize</span><span class="o">=</span><span class="mi">180</span>
</pre></div>
</div>
<p>It’s possible that, instead of hard-coding it like this, it’s better to make a call to <cite>wx.NewId()</cite> – wx will take care of avoiding duplicate IDs, presumably.</p>
</div>
<div class="section" id="key-binding-prefs">
<h2>3. Key-binding prefs<a class="headerlink" href="#key-binding-prefs" title="Permalink to this headline">¶</a></h2>
<p>I also defined a key to use to as a keyboard short-cut for activating the new menu item:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="s1">&#39;largerRoutine&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The actual key is defined in a preference file. Because psychopy is multi-platform, you need to add info to four different .spec files, all of them being within the <cite>psychopy/preferences/</cite> directory, for four operating systems (Darwin, FreeBSD, Linux, Windows). For <cite>Darwin.spec</cite> (meaning macOS), I added two lines. The first line is not merely a comment: it is also automatically used as a tooltip (in the preferences dialog, under key-bindings), and the second being the actual short-cut key to use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># increase display size of Routines</span>
<span class="n">largerRoutine</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;Ctrl++&#39;</span><span class="p">)</span> <span class="c1"># on Mac Book Pro this is good</span>
</pre></div>
</div>
<p>This means that the user has to hold down the <cite>Ctrl</cite> key and then press the <cite>+</cite> key. Note that on Macs, ‘Ctrl’ in the spec is automatically converted into ‘Cmd’ for the actual key to use; in the .spec, you should always specify things in terms of ‘Ctrl’ (and not ‘Cmd’). The default value is the key-binding to use unless the user defines another one in her or his preferences (which then overrides the default). Try to pick a sensible key for each operating system, and update all four .spec files.</p>
</div>
<div class="section" id="your-new-method">
<h2>4. Your new method<a class="headerlink" href="#your-new-method" title="Permalink to this headline">¶</a></h2>
<p>The second line within <cite>makeMenus()</cite> adds the key-binding definition into wx’s internal space, so that when the key is pressed, <cite>wx</cite> knows what to do. In the example, it will call the method <cite>self.routinePanel.increaseSize</cite>, which I had to define to do the desired behavior when the method is called (in this case, increment an internal variable and redraw the routine panel at the new larger size).</p>
</div>
<div class="section" id="documentation">
<h2>5. Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<p>To let people know that your new feature exists, add a note about your new feature in the CHANGELOG.txt, and appropriate documentation in .rst files.</p>
</div>
</div>


          </div>
        </div>
      </div>

      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../psyexp.html" title="PsychoPy Experiment file format (.psyexp)"
             >next</a> |</li>
        <li class="right" >
          <a href="localization.html" title="Localization (I18N, translation)"
             >previous</a> |</li>
        <li><a href="../index.html">PsychoPy</a> &raquo;</li>
          <li><a href="../documentation.html" >Documentation</a> &raquo;</li>
          <li><a href="developers.html" >For Developers</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2018, Jonathan Peirce.
      Last updated on Jul 25, 2018.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.7.0.
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-4089651-2', 'auto');
      ga('send', 'pageview');

    </script>

    <script type="text/javascript" src="http://www.ohloh.net/p/17081/widgets/project_partner_badge.js"></script>
    </div>
  </body>
</html>